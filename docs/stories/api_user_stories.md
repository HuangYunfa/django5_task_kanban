# API (应用程序编程接口) - 用户故事

## 1. 认证与授权

### 故事 1.1：获取认证令牌 (Token)

**作为** 一名开发者，
**我想要** 通过提供我的用户名和密码来调用一个API端点，以获取一个JWT（JSON Web Token）访问令牌，
**以便** 我可以在后续的API请求中验证我的身份。

**验收标准：**
- 有一个公开的API端点（例如 `/api/token/`）用于获取令牌。
- 使用 `POST` 方法，并在请求体中发送 `username` 和 `password`。
- 如果凭据有效，API会返回一个包含 `access` 和 `refresh` 令牌的JSON响应。
- `access` 令牌用于在短时间内访问受保护的资源。
- `refresh` 令牌用于在 `access` 令牌过期后获取新的 `access` 令牌。

### 故事 1.2：使用令牌访问受保护的资源

**作为** 一名开发者，
**我想要** 在请求头中携带我的访问令牌来调用受保护的API端点，
**以便** 系统可以验证我的身份并授权我访问相应的数据。

**验收标准：**
- 在调用需要认证的API时，我需要在 `Authorization` 请求头中添加 `Bearer <access_token>`。
- 如果令牌有效且我有相应权限，API会返回 `200 OK` 和请求的数据。
- 如果令牌无效或过期，API会返回 `401 Unauthorized` 错误。
- 如果令牌有效但我没有权限访问该资源，API会返回 `403 Forbidden` 错误。

## 2. 看板 (Boards) API

### 故事 2.1：获取看板列表

**作为** 一名开发者，
**我想要** 调用一个API端点来获取我所有有权访问的看板列表，
**以便** 我可以在我的第三方应用中展示这些看板。

**验收标准：**
- `GET /api/boards/` 会返回一个包含看板对象的数组。
- 每个看板对象都包含其ID、名称、描述和所有者信息。
- 返回的列表只包含我创建的、我是其成员的或设置为公开的看板。

### 故事 2.2：创建和管理看板

**作为** 一名开发者，
**我想要** 通过API来创建、更新或删除一个看板，
**以便** 我可以编程方式地管理项目空间。

**验收标准：**
- `POST /api/boards/` 并提供看板名称等数据，可以创建一个新看板。
- `PUT /api/boards/{board_id}/` 或 `PATCH /api/boards/{board_id}/` 可以更新一个现有看板的信息。
- `DELETE /api/boards/{board_id}/` 可以删除一个看板（需要相应权限）。

## 3. 任务 (Tasks) API

### 故事 3.1：获取指定看板的任务

**作为** 一名开发者，
**我想要** 调用一个API端点，并传入看板ID，来获取该看板下的所有任务，
**以便** 我可以构建一个自定义的任务展示界面。

**验收标准：**
- `GET /api/tasks/?board_id={board_id}` 会返回指定看板下的任务列表。
- API支持通过参数进行筛选（如按 `status`, `priority`, `assignee`）。
- API支持分页，以处理大量任务的情况。

### 故事 3.2：创建和管理任务

**作为** 一名开发者，
**我想要** 通过API在一个看板的特定列表中创建新任务，并能更新任务的状态、负责人等信息，
**以便** 我可以将我的应用（如代码仓库、客服系统）中的事件同步为任务。

**验收标准：**
- `POST /api/tasks/` 并提供标题、看板ID、列表ID等信息，可以创建一个新任务。
- `GET /api/tasks/{task_id}/` 可以获取单个任务的详细信息，包括评论和附件。
- `PATCH /api/tasks/{task_id}/` 可以更新任务的任何字段，如 `status`, `assignees`, `due_date` 等。
- `DELETE /api/tasks/{task_id}/` 可以删除一个任务。

## 4. Webhooks (高级功能)

### 故事 4.1：配置Webhook

**作为** 一名开发者，
**我想要** 通过API为一个看板或项目配置一个Webhook，
**以便** 当看板内发生特定事件（如创建任务、更新状态）时，我的应用能够接收到实时的HTTP通知。

**验收标准：**
- 有一个API端点用于创建和管理Webhook（例如 `POST /api/boards/{board_id}/webhooks/`）。
- 创建时需要提供一个我的应用可以接收HTTP POST请求的URL。
- 可以选择我希望订阅的事件类型（如 `task:created`, `task:updated`, `comment:posted`）。

### 故事 4.2：接收Webhook通知

**作为** 一名开发者，
**我想要** 在我的服务器上接收来自任务管理系统的Webhook推送，
**以便** 我可以根据这些事件触发自动化流程。

**验收标准：**
- 当订阅的事件发生时，任务管理系统会向我配置的URL发送一个 `POST` 请求。
- 请求的Body是一个JSON对象，包含了事件类型和相关的详细数据（例如，如果是任务创建事件，则包含完整的任务对象信息）。
- （可选）请求头中包含一个签名，我可以用它来验证请求确实来自任务管理系统，以确保安全。
