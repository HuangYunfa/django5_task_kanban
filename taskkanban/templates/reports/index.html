{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "数据报表" %}{% endblock %}

{% block content %}
<!-- 页面头部 -->
<div class="page-header">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="mb-0">
                    <i class="fas fa-chart-bar me-3"></i>
                    数据报表
                </h1>
                <p class="lead mb-0">数据驱动决策，洞察团队表现与项目进展</p>
            </div>
            <div class="col-md-4 text-md-end">
                <div class="btn-group" role="group">
                    <a href="{% url 'reports:create' %}" class="btn btn-light btn-sm">
                        <i class="fas fa-plus me-1"></i>自定义报表
                    </a>
                    <button class="btn btn-light btn-sm" onclick="exportReport()">
                        <i class="fas fa-download me-1"></i>导出数据
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 关键指标统计 -->
<div class="row g-4 mb-5">
    <div class="col-md-3 col-6">
        <div class="card stats-card h-100">
            <div class="card-body text-center">
                <div class="stats-number text-primary">{{ total_tasks }}</div>
                <div class="stats-label">总任务数</div>
                <div class="mt-3">
                    <i class="fas fa-tasks text-primary fa-2x"></i>
                </div>
                <div class="mt-2">
                    <small class="text-muted">较上周 +12%</small>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3 col-6">
        <div class="card stats-card h-100">
            <div class="card-body text-center">
                <div class="stats-number text-success">{{ completion_rate }}%</div>
                <div class="stats-label">完成率</div>
                <div class="mt-3">
                    <i class="fas fa-check-circle text-success fa-2x"></i>
                </div>
                <div class="mt-2">
                    <small class="text-muted">较上周 +5%</small>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3 col-6">
        <div class="card stats-card h-100">
            <div class="card-body text-center">
                <div class="stats-number text-warning">{{ avg_completion_time }}</div>
                <div class="stats-label">平均完成时间</div>
                <div class="mt-3">
                    <i class="fas fa-clock text-warning fa-2x"></i>
                </div>
                <div class="mt-2">
                    <small class="text-muted">天</small>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3 col-6">
        <div class="card stats-card h-100">
            <div class="card-body text-center">
                <div class="stats-number text-info">{{ team_productivity }}</div>
                <div class="stats-label">团队生产力</div>
                <div class="mt-3">
                    <i class="fas fa-chart-line text-info fa-2x"></i>
                </div>
                <div class="mt-2">
                    <small class="text-muted">较上周 +8%</small>
                </div>
            </div>
        </div>    </div>
</div>

<!-- 图表展示区域 -->
<div class="row g-4 mb-5">
    <div class="col-md-8">
        <div class="card chart-container h-100">
            <div class="card-header">
                <h5 class="chart-title mb-0">任务完成趋势</h5>
            </div>
            <div class="card-body">
                <canvas id="taskChart" height="300"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card recent-reports h-100">
            <div class="card-header">
                <h5 class="mb-0">最近报表</h5>
            </div>
            <div class="card-body">
                <div class="report-item">
                    <div class="report-name">项目进度报表</div>
                    <div class="report-date">2024-01-15</div>
                </div>
                <div class="report-item">
                    <div class="report-name">团队效率分析</div>
                    <div class="report-date">2024-01-12</div>
                </div>
                <div class="report-item">
                    <div class="report-name">任务分布统计</div>
                    <div class="report-date">2024-01-10</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 筛选操作区域 -->
<div class="filter-section">
    <div class="row align-items-center">
        <div class="col-md-8">
            <div class="row g-3">
                <div class="col-md-3">
                    <select class="form-select">
                        <option>选择时间范围</option>
                        <option>最近7天</option>
                        <option>最近30天</option>
                        <option>最近90天</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select class="form-select">
                        <option>选择项目</option>
                        <option>项目A</option>
                        <option>项目B</option>
                        <option>项目C</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select class="form-select">
                        <option>选择团队</option>
                        <option>开发团队</option>
                        <option>设计团队</option>
                        <option>测试团队</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <button class="btn btn-primary w-100">
                        <i class="fas fa-search me-2"></i>筛选
                    </button>
                </div>
            </div>
        </div>
        <div class="col-md-4 text-md-end">
            <button class="btn btn-outline-secondary me-2">重置</button>
            <button class="btn btn-success">导出报表</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.chart-title {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: #495057;
}

.filter-section {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 1.5rem;
    margin-bottom: 2rem;
}

.recent-reports {
    background: white;
    border-radius: 10px;
    padding: 1.5rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.report-item {
    padding: 0.8rem;
    border-left: 3px solid #007bff;
    background: #f8f9fa;
    margin-bottom: 0.8rem;
    border-radius: 0 5px 5px 0;
    transition: background-color 0.2s;
}

.report-item:hover {
    background: #e9ecef;
}

.report-name {
    font-weight: 600;
    color: #495057;
}

.report-date {
    font-size: 0.8rem;
    color: #6c757d;
}
</style>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Chart initialization code here
});
</script>
{% endblock %}
